# 회의실 관리 시스템 기획서 (meeting)

## 0. 문서 정보
- 문서명: 회의실 관리 시스템 기획서
- 프로젝트명: meeting
- 작성 기준: JSP/Servlet + Tomcat + MySQL(Docker) + Maven
- 범위: 관리자/사용자 화면 + 회의실 관리 + 예약 + 채팅(WebSocket)
- 문서 목적:
    - 개발 전 기능/화면/정책을 명확히 정의
    - 개발 중 변경사항을 추적할 기준점 제공

---

## 1. 프로젝트 개요

### 1.1 목표
- 조직/스터디/팀 단위에서 회의실을 등록하고, 사용자가 시간을 선택해 예약할 수 있다.
- 예약 중복을 방지한다(동시 요청 포함).
- 회의실 단위 실시간 채팅을 제공한다(필요 시 채팅 로그 저장).

### 1.2 사용자 유형
| 유형 | 역할 | 주요 권한 |
|---|---|---|
| ADMIN | 관리자 | 회의실 CRUD, 전체 예약 조회/관리, 사용자 관리(옵션) |
| USER | 사용자 | 회의실 조회, 예약 생성/취소, 채팅 참여 |

---

## 2. 용어 정의
- 회의실(Room): 예약 가능한 자원
- 예약(Reservation): 특정 회의실의 시간 구간 사용권
- 예약 충돌(Overlap): 동일 회의실에 대해 시간이 겹치는 예약이 존재하는 상태
- 세션(Session): 로그인 상태를 유지하는 서버 측 저장소
- 컨텍스트 경로(Context Path): `/meeting`
- 채팅방(Chat Room): 회의실 별 채팅 채널(= room_id 단위)

---

## 3. 시스템 구성/아키텍처

### 3.1 구성 요소
- Web: Tomcat 10.1.x, JSP/Servlet
- DB: MySQL 8.0 (Docker Compose)
- 통신:
    - HTTP: 화면 렌더링 및 CRUD
    - WebSocket: 실시간 채팅

### 3.2 레이어 구조(원칙)
- Controller(Servlet): 요청/응답 처리(얇게)
- Service: 비즈니스 로직(검증/정책/트랜잭션 단위)
- DAO: SQL 수행(데이터 접근 단일 책임)
- DTO: 데이터 전달 객체(필드/게터/세터)

---

## 4. 기능 요구사항(상세)

## 4.1 인증/인가

### 4.1.1 로그인
- 입력: login_id, password
- 처리:
    1) login_id로 사용자 조회
    2) password 검증(초기: 평문 비교 → 이후 BCrypt 적용)
    3) 성공 시 세션에 사용자 정보 저장
- 출력:
    - 성공: 사용자 홈 이동
    - 실패: 에러 메시지 + 로그인 페이지 유지

#### 로그인 실패 정책(초기)
- login_id 미존재: “아이디 또는 비밀번호가 올바르지 않습니다.”
- password 불일치: 동일 메시지
- (옵션) 실패 횟수 누적, 일정 횟수 초과 시 잠금

### 4.1.2 로그아웃
- 세션 무효화 후 로그인 페이지로 이동

### 4.1.3 권한 제어
- ADMIN 전용 URL: `/admin/*`
- USER 전용 URL: `/user/*`
- 공통 URL: `/auth/*`, `/public/*`
- 정책:
    - 비로그인: 로그인 페이지로 리다이렉트
    - 로그인했지만 권한 불일치: 403 페이지 또는 홈으로 리다이렉트

---

## 4.2 관리자 기능

### 4.2.1 회의실 CRUD
#### 생성(Create)
- 입력: name(필수), capacity(필수, 양수)
- 검증:
    - name 중복 허용 여부: 기본은 “허용”(단, UX 위해 유사명 체크 가능)
    - capacity: 1 이상
- 결과: 생성 후 목록으로 이동

#### 목록(List)
- 출력: id, name, capacity, created_at
- 정렬: created_at DESC 또는 name ASC(선택)

#### 수정(Update)
- 입력: name, capacity
- 검증: 생성과 동일
- 결과: 수정 후 상세 or 목록

#### 삭제(Delete)
- 정책:
    - 이미 미래 예약이 존재하면 삭제 불가(권장)
    - 또는 “삭제 시 관련 예약도 삭제” 선택 가능(초기에는 삭제 불가 권장)
- 결과: 성공/실패 메시지

---

### 4.2.2 예약 관리(관리자)
- 전체 예약 조회
- 필터:
    - 기간(start~end)
    - 회의실(room_id)
    - 사용자(login_id 또는 name)
- 상세:
    - 예약 id, 사용자, 회의실, 시작/종료, 생성일

---

## 4.3 사용자 기능

### 4.3.1 회의실 조회
- 목록:
    - 회의실명, 수용인원
    - “예약하기” 버튼
- 상세:
    - 회의실 기본 정보
    - 선택 날짜 기준 예약 현황(타임라인 또는 리스트)

### 4.3.2 예약 생성
- 입력:
    - room_id
    - start_time (DATETIME)
    - end_time (DATETIME)
- 검증(필수):
    - start_time < end_time
    - 예약 최소 단위(예: 30분) 정책은 추후 선택
    - 현재시간 기준 과거 예약 금지
    - 동일 사용자 동시간대 중복 예약 금지(옵션)
    - **예약 중복 방지(핵심)**: 동일 room_id에 대해 시간 구간이 겹치면 실패

#### 예약 중복 정의(권장 로직)
- 두 구간 [A_start, A_end) 와 [B_start, B_end) 가 겹치는 조건:
    - A_start < B_end AND A_end > B_start
- SQL 체크:
    - `SELECT COUNT(*) FROM reservation WHERE room_id=? AND start_time < ? AND end_time > ?`
    - 위에서 `?`는 (new_end, new_start)

#### 동시성(동시 요청) 처리(권장)
- 트랜잭션 사용
- (옵션1) 예약 테이블 조회 + INSERT 를 하나의 트랜잭션으로
- (옵션2) 더 강하게 하려면 room_id 단위 잠금 테이블/레코드 잠금 설계
- 초기 버전에서는:
    - 트랜잭션 + 중복 체크 + INSERT
    - 인덱스 추가로 성능/안정성 확보

### 4.3.3 예약 취소
- 정책:
    - 본인 예약만 취소 가능
    - (옵션) 시작 시간 이전만 취소 가능
- 결과: 성공/실패 메시지

---

## 4.4 채팅 기능(WebSocket)

### 4.4.1 기본 동작
- 회의실(room_id) 단위 채팅 채널
- 메시지 구성:
    - sender(사용자명 또는 login_id)
    - content
    - sent_at(서버 시간)
- 접속/퇴장 이벤트:
    - “OOO님이 입장했습니다.”
    - “OOO님이 퇴장했습니다.”

### 4.4.2 채팅 저장(옵션)
- 저장 여부: 초기에는 “저장 기능 옵션”으로 두고 나중에 붙일 수 있도록 설계
- 저장 시 테이블 예:
    - chat_message(id, room_id, user_id, content, sent_at)
- 조회:
    - 최근 50개 로딩, 이후 페이징(옵션)

### 4.4.3 보안/권한
- 로그인 세션이 있어야 연결 가능
- 연결 시 room_id에 대한 접근 권한 확인:
    - 기본: 로그인만 했으면 접근 가능
    - 확장: 예약자만 접근 가능(선택)

---

## 5. 화면 설계(최소 화면 정의)

## 5.1 공통
- 헤더: 로그인 상태 표시, 로그아웃, 메뉴
- 기본 에러 페이지:
    - 401(로그인 필요)
    - 403(권한 없음)
    - 404, 500

## 5.2 로그인
- URL: `/auth/login`
- 구성:
    - login_id 입력
    - password 입력
    - 로그인 버튼
    - 에러 메시지 영역

## 5.3 관리자 화면
- URL Prefix: `/admin`
- 메뉴:
    - 회의실 관리
    - 예약 관리

### 회의실 관리
- 목록: `/admin/rooms`
- 생성: `/admin/rooms/new`
- 수정: `/admin/rooms/edit?id=`
- 삭제: 목록에서 삭제 액션

### 예약 관리
- 목록: `/admin/reservations`
- 상세: `/admin/reservations/detail?id=`

## 5.4 사용자 화면
- URL Prefix: `/user`
- 메뉴:
    - 회의실 목록
    - 내 예약

### 회의실
- 목록: `/user/rooms`
- 상세(예약): `/user/rooms/detail?id=`
- 예약 생성: 상세 화면에서 POST

### 내 예약
- `/user/reservations`
- 취소: 예약 row에서 취소

## 5.5 채팅
- `/chat?room_id=`
- UI:
    - 메시지 리스트
    - 입력창
    - 전송 버튼

---

## 6. API/URL 설계(초기)

### 6.1 Auth
- GET `/auth/login` (로그인 화면)
- POST `/auth/login` (로그인 처리)
- POST `/auth/logout` (로그아웃)

### 6.2 Admin
- GET `/admin/rooms`
- GET `/admin/rooms/new`
- POST `/admin/rooms/create`
- GET `/admin/rooms/edit`
- POST `/admin/rooms/update`
- POST `/admin/rooms/delete`
- GET `/admin/reservations`
- GET `/admin/reservations/detail`

### 6.3 User
- GET `/user/rooms`
- GET `/user/rooms/detail`
- POST `/user/reservations/create`
- GET `/user/reservations`
- POST `/user/reservations/cancel`

### 6.4 Chat
- GET `/chat?room_id=`
- WS `/ws/chat?room_id=`
    - 메시지 broadcast

---

## 7. 데이터베이스 상세 설계

## 7.1 DB 기본 설정
- DB: meeting_room
- Charset/Collation:
    - utf8mb4 / utf8mb4_unicode_ci
- Timezone: Asia/Seoul

## 7.2 테이블 정의(초기)

### 7.2.1 user
- id (PK)
- login_id (UNIQUE)
- password
- name
- role (ENUM: ADMIN/USER)
- created_at

**인덱스**
- UNIQUE(login_id)

### 7.2.2 room
- id (PK)
- name
- capacity
- created_at

**인덱스**
- (선택) idx_room_name(name)

### 7.2.3 reservation
- id (PK)
- user_id (FK)
- room_id (FK)
- start_time
- end_time
- created_at

**중복 체크 인덱스(권장)**
- idx_reservation_room_time(room_id, start_time, end_time)

---

## 8. 예외/에러 정책

- 입력 검증 실패: 400 + 메시지
- 권한 없음: 403 페이지
- 로그인 필요: 401 또는 로그인 페이지 리다이렉트
- DB 오류: 500 + 로그 출력(개발 단계), 사용자에게는 일반 메시지

---

## 9. 로깅/운영(초기 기준)
- 개발 단계:
    - 예외 stack trace 콘솔 출력
- 추후:
    - 파일 로그, 요청 추적, 보안 로그(로그인 실패 등)

---

## 10. 개발 단계(마일스톤)
1) DB 스키마/도커 기반 세팅
2) DAO/Service 기반 구조 확정 + 단위 테스트
3) 로그인/세션/권한 필터
4) 회의실 CRUD (관리자)
5) 예약(사용자) + 중복 방지
6) 채팅(WebSocket)
7) (옵션) 채팅 로그 저장
8) 테스트/리팩토링/문서화

---

## 11. 범위 확장 후보(Backlog)
- 예약 승인(관리자 승인 후 확정)
- 반복 예약(매주 같은 시간)
- 알림(메일/푸시)
- 통계(회의실별 사용량)
- 관리자 사용자 관리(추가/권한 변경)
